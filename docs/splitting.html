
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Camping 2025: Debt Be Gone</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      padding: 2rem;
      background: #f0f4f9;
      color: #333;
      line-height: 1.6;
    }

    h1, h2 {
  color: #4b6cb7; /* A nice blue gradient start */
  background: linear-gradient(to right, #4b6cb7, #182848);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  text-shadow: 1px 1px 2px rgba(0,0,0,0.2);

}


    p {
      margin-bottom: 1rem;
      color: #34495e;
    }

    .explanation {
      background: #ffffff;
      border: 1px solid #ccd6dd;
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
      white-space: pre-wrap;
    }
    details {
  margin-bottom: 1rem;
  background: #f9f9f9;
  border-radius: 8px;
  border: 1px solid #ccc;
  padding: 0.5rem 1rem;
}

summary {
  font-weight: bold;
  cursor: pointer;
  color: #2c3e50;
  font-size: 1.05rem;
}

details pre {
  margin: 0.5rem 0 0 0;
  white-space: pre-wrap;
  font-family: inherit;
}


    .explanation p {
      margin: 0.5rem 0;
    }

    .explanation p:nth-child(odd) {
      background-color: #e3f2fd;
      padding: 0.3rem 0.6rem;
      border-radius: 4px;
    }

    .explanation p:nth-child(even) {
      background-color: #fef9e7;
      padding: 0.3rem 0.6rem;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <h1>Camping 2025: Debt Be Gone</h1>
  <p>Hey queens, here is what everyone owes. thanks for the patience LOL and apologies if this is anti-climatic hehe. I temporarily abandoned my more impressive splitting app (coming in the future) and made this simple page to get the job done for rn . formulas used at the bottom if you wanna verify my math lmao.</p>

  <div class="explanation" id="output"></div>

  <script>
    // ===== INPUTS =====
    const expenses = [
  { description: "The Point Market", amount: 31.42, paidBy: "George" },
  { description: "Trader Joe's Camarillo", amount: 36.42, paidBy: "Jake" },
  { description: "Trader Joe's Emeryville", amount: 117.12, paidBy: "Jake" },
  { description: "Target Emeryville", amount: 132.04, paidBy: "Leo" },
  { description: "Camp Store", amount: 80, paidBy: "Sierra" }
];


const days = [
  { name: "Thursday", weight: 0.5 },
  { name: "Friday", weight: 1.0 },
  { name: "Saturday", weight: 1.0 },
  { name: "Sunday", weight: 1.0 }
];


const people = [
  { name: "Jake", attendance: { Thursday: 1, Friday: 1, Saturday: 1, Sunday: 1 } },
  { name: "George", attendance: { Thursday: 1, Friday: 1, Saturday: 1, Sunday: 1 } },
  { name: "Sierra", attendance: { Thursday: 1, Friday: 1, Saturday: 1, Sunday: 1 } },
  { name: "Leo", attendance: { Thursday: 1, Friday: 1, Saturday: 1, Sunday: 1 } },
  { name: "Joe", attendance: { Thursday: 1, Friday: 1, Saturday: 1, Sunday: 1 } },
  { name: "Krease", attendance: { Thursday: 1, Friday: 1, Saturday: 1, Sunday: 1/3 } },
  { name: "Nellie", attendance: { Thursday: 0, Friday: 0, Saturday: 1/3, Sunday: 1 } }
];


    // ===== DERIVED VALUES =====
    const totalCost = expenses.reduce((sum, e) => sum + e.amount, 0);
    const totalWeight = days.reduce((sum, d) => sum + d.weight, 0);

    const dayCosts = {};
    for (const d of days) {
      dayCosts[d.name] = (d.weight / totalWeight) * totalCost;
    }

    const personOwes = {};
    const perDayBreakdown = {};
    for (const day of days.map(d => d.name)) {
      perDayBreakdown[day] = [];
    }

    for (const p of people) {
      let total = 0;
      for (const [day, fraction] of Object.entries(p.attendance)) {
        const attendees = people.map(peep => peep.attendance[day] || 0).reduce((a, b) => a + b, 0);
        const share = attendees > 0 ? ((fraction || 0) / attendees) * (dayCosts[day] || 0) : 0;
        total += share;
        perDayBreakdown[day].push({ name: p.name, share });
      }
      personOwes[p.name] = total;
    }

    const personPaid = {};
    for (const e of expenses) {
      personPaid[e.paidBy] = (personPaid[e.paidBy] || 0) + e.amount;
    }

    const balances = {};
    for (const p of people) {
      balances[p.name] = (personPaid[p.name] || 0) - (personOwes[p.name] || 0);
    }

    // ===== SETTLEMENT =====
    const payers = [], receivers = [];
    for (const [person, balance] of Object.entries(balances)) {
      if (balance < -0.01) payers.push({ name: person, amount: -balance });
      else if (balance > 0.01) receivers.push({ name: person, amount: balance });
    }

    const settlements = [];
    while (payers.length && receivers.length) {
      const payer = payers[0];
      const receiver = receivers[0];
      const amount = Math.min(payer.amount, receiver.amount);

      settlements.push(`${payer.name} owes ${receiver.name} $${amount.toFixed(2)}`);

      payer.amount -= amount;
      receiver.amount -= amount;

      if (payer.amount < 0.01) payers.shift();
      if (receiver.amount < 0.01) receivers.shift();
    }

    // ===== EXPLANATION =====
    const lines = [];
    lines.push(`Total trip cost: $${totalCost.toFixed(2)}`);
    for (const e of expenses) {
      lines.push(`${e.paidBy} paid $${e.amount} for ${e.description}.`);
    }
    lines.push("\nDay weights:");
    for (const d of days) {
      lines.push(`${d.name} had weight ${d.weight}, costing $${dayCosts[d.name].toFixed(2)}.`);
    }

    lines.push("\nIndividual breakdowns:");
    for (const p of people) {
      lines.push(`${p.name} was present:`);
      let total = 0;
      for (const [day, fraction] of Object.entries(p.attendance)) {
        const attendees = people.map(peep => peep.attendance[day] || 0).reduce((a, b) => a + b, 0);
        const share = attendees > 0 ? ((fraction || 0) / attendees) * (dayCosts[day] || 0) : 0;
        total += share;
        lines.push(`  - ${fraction} of ${day}, owing $${share.toFixed(2)}`);
      }
      lines.push(`  => Total owed: $${total.toFixed(2)}`);
      lines.push(`  => Paid: $${(personPaid[p.name] || 0).toFixed(2)}`);
      lines.push(`  => Net balance: $${balances[p.name].toFixed(2)}\n`);
    }

    lines.push("\nPer-day cost justification:");
    for (const [day, shares] of Object.entries(perDayBreakdown)) {
      const total = shares.reduce((sum, s) => sum + s.share, 0);
      lines.push(`  ${day} shares:`);
      for (const s of shares) {
        lines.push(`    - ${s.name} pays $${s.share.toFixed(2)}`);
      }
      lines.push(`  => Total collected: $${total.toFixed(2)} (expected: $${dayCosts[day].toFixed(2)})\n`);
    }

    if (settlements.length > 0) {
  lines.push("\nSettlement suggestions:");
  const receiverReceipts = {};

  for (const s of settlements) {
    lines.push(s);
    const [payerName, , receiverName, amountStr] = s.split(" ");
    const amount = parseFloat(amountStr.slice(1)); // remove $ symbol
    if (!receiverReceipts[receiverName]) receiverReceipts[receiverName] = [];
    receiverReceipts[receiverName].push({ from: payerName, amount });
  }

  for (const [receiver, receipts] of Object.entries(receiverReceipts)) {
    const totalReceived = receipts.reduce((sum, r) => sum + r.amount, 0);
    const target = balances[receiver].toFixed(2);
    lines.push(`\n${receiver} receives:`);
    for (const r of receipts) {
      lines.push(`  - $${r.amount.toFixed(2)} from ${r.from}`);
    }
    lines.push(`  => Total received: $${totalReceived.toFixed(2)}. Target balance: $${parseFloat(target).toFixed(2)}\n`);
  }
} else {
  lines.push("\nEveryone has settled up correctly.");
}
lines.push(`FORMULAS USED:\n`);
lines.push(`1. Total trip cost = sum of all expenses`);
lines.push(`2. Cost of a day = (day's weight ÷ total weight of all days) × total trip cost`);
lines.push(`3. Person's share of a day = (person's attendance weight on that day ÷ total attendance weight that day) × cost of the day`);
lines.push(`4. Net balance = amount paid − amount owed`);
lines.push(`5. Settlements match people with negative balances to those with positive balances until everyone nets to $0`);
lines.push(`\n`);


    // === GROUP AND INJECT DROPDOWN SECTIONS ===
const outputDiv = document.getElementById("output");

function createDropdown(title, contentLines) {
  const details = document.createElement("details");
  details.open = true;

  const summary = document.createElement("summary");
  summary.textContent = title;

  const pre = document.createElement("pre");
  pre.textContent = contentLines.join("\n");

  details.appendChild(summary);
  details.appendChild(pre);
  return details;
}

function extractSection(startMatch, endMatch) {
  const startIdx = lines.findIndex(line => line.trim().startsWith(startMatch.trim()));
  const endIdx = endMatch
    ? lines.findIndex((line, i) => i > startIdx && line.trim().startsWith(endMatch.trim()))
    : lines.length;
  return startIdx !== -1 ? lines.slice(startIdx, endIdx) : [];
}



// Build sections
outputDiv.appendChild(createDropdown("Total Trip Cost", extractSection("Total trip cost:", "Day weights:")));
outputDiv.appendChild(createDropdown("Day Weights", extractSection("Day weights:", "Individual breakdowns:")));
outputDiv.appendChild(createDropdown("Individual Breakdowns", extractSection("Individual breakdowns:", "Per-day cost justification:")));
outputDiv.appendChild(createDropdown("Per-Day Cost Justification", extractSection("Per-day cost justification:", "Settlement suggestions:")));

const hasSettlement = lines.some(l => l.startsWith("Settlement suggestions:") || l.startsWith("Everyone has settled up correctly."));

if (hasSettlement) {
  const settleStart = lines.findIndex(l => l.startsWith("Settlement suggestions:") || l.startsWith("Everyone has settled up correctly."));
  const formulasStart = lines.findIndex(l => l.startsWith("FORMULAS USED:"));
  outputDiv.appendChild(createDropdown("Settlement Suggestions", lines.slice(settleStart, formulasStart)));
}

outputDiv.appendChild(createDropdown("Formulas Used", lines.slice(lines.findIndex(l => l.startsWith("FORMULAS USED:")))));

  </script>

  
</body>
</html>